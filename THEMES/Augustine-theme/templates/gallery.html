<!-- 
_______________________________________________________________________________

                                    GALLERY
_______________________________________________________________________________

Description :
-------------
Cette page du template reçoit exploite le contenu du plugin gallery_plugin pour produire
l'affichage d'une page avec les thumbnails (vignettes).
-->


<!-- Définition de macros : -->
<!-- ---------------------- -->
{% macro format_date(date, format_string, default='N/A') %}
    {% if date %}
        {{ date.strftime(format_string) }}
    {% else %}
        {{ default }}
    {% endif %}
{% endmacro %}


{% extends "base.html" %}

<!-- Icone de l'onglet de navigation : -->
{% block faviBloc %} 
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png">
{% endblock %}

<!-- CONTENU SOUS-EN-TETE : -->
{% block contenu_sous_tete %}
        <div class="text-light py-1 small">
        <span><i class="bi bi-camera-fill me-2 text-warning"></i><b class="text-warning">Photos : </b></span>
        {{ galerie_name }}
    </div>    
{% endblock %}


{% block content %}

    <!-- Titre : -->
    <div class="d-flex m-0 mb-3">
        <div class="m-0 py-1 px-3 d-flex align-items-center section-titre text-center fs-3 rounded-start-3 shadow">
            <i class="bi bi-camera-fill text-warning"></i>
        </div>
        <div class="m-0 bg-secondary shadow" style="width: 5px;"></div>
        <div class="flex-grow-1 p-1 ps-3 pe-4 rounded-end-3 bg-warning text-dark fs-5 d-flex align-items-center shadow">
            <b class="me-2 text-body-secondary">Photos :</b> {{ galerie_name }}
        </div>
    </div>

         
    <!-- Titre :
    <div class="d-flex m-0 mb-3">
        <div class="m-0 py-1 px-3 d-flex align-items-center bg-black text-center fs-3 rounded-start-3 shadow">
            <i class="bi bi-camera-fill text-warning"></i>
        </div>
        <div class="m-0 bg-secondary shadow" style="width: 5px;"></div>
        <div class="flex-grow-1 p-1 ps-3 pe-4 rounded-end-3 text-warning fs-4 d-flex align-items-center shadow section-titre">
            <b class="me-2 text-light">Photos :</b> {{ galerie_name }}
        </div>
    </div>

   
    Titre : 
    <div class="d-flex m-0 mb-3">
        <div class="m-0 py-1 px-3 d-flex align-items-center bg-warning text-center fs-3 rounded-start-3 shadow">
            <i class="bi bi-camera-fill text-dark"></i>
        </div>
        <div class="m-0 bg-secondary shadow" style="width: 5px;"></div>
        <div class="flex-grow-1 p-1 ps-3 pe-4 rounded-end-3 text-warning fs-4 d-flex align-items-center shadow section-titre">
            <b class="me-2 text-light">Photos :</b> {{ galerie_name }}
        </div>
    </div> -->


    <!-- Options d'affichage : -->
    <div class="mx-3 my-4 p-3 rounded-3 shadow text-light" style="background-color:rgb(50, 50, 50)">
        
        <h5 class="mb-3 text-warning"><u>Choix des options d'affichage :</u></h5>

        <!-- Afficher/masque les informations sous les vignettes : -->
        <div class="form-check form-switch ms-4 my-2">
            <input class="form-check-input" type="checkbox" id="switch-infos-photos" checked>
            <label class="form-check-label" for="switch-infos-photos">Afficher/masquer les informations</label>
        </div>

        <!-- Choix de la taille des vignettes : -->
        <div class="ms-4">
            <div class="text-warning mb-2">Taille des vignettes :</div>
            <select class="form-select ms-1" style="width: 200px" id="select-size">                
                <option value="256">Grande (256 px)</option>
                <option value="128">Petite (128 px)</option>
            </select>
        </div>
    </div>


    <!-- Affichage des vignettes : -->
    <div class="row m-0 ms-3 p-0">
        {% for dico_image in images %}
            <div class="card border-1 p-0 shadow m-1 mx-auto size-thumbnail" style="width:256px;">
                
                <!-- Photo : -->
                <a  href="" data-bs-toggle="modal" data-bs-target="#{{ dico_image.name }}" title="Ouvrir la photo">
                <img src="{{ SITEURL }}/galerie/{{ galerie_name }}/thumbnails/thumbnail_{{ dico_image.name }}"
                    class="card-img-top p-0  border border-0 border-warning p-2" alt="{{ dico_image.name }}"
                    style="background-color:rgb(55, 55, 55)">         
                </a>

                <!-- Informations EXIF extraites des photos : -->
                <div class="card-body small text-body-secondary border-top border-1 border-black m-0 py-1 px-3 info-exif">
                    <p class="card-text my-1">
                        <b class="text-black"><i class="bi bi-calendar-day"></i> : </b>
                        {% if dico_image.date %}{{ format_date(dico_image.date, '%d/%m/%Y') }}{% else %}N.R{% endif %}
                        <b class="text-black ms-2"><i class="bi bi-clock"></i> : </b>
                        {% if dico_image.date %}{{ format_date(dico_image.date, '%H:%M') }}{% else %}N.R{% endif %}
                    </p>

                    <p class="card-text my-1"><b class="text-black"><i class="bi bi-aspect-ratio"></i> : </b>
                        {% if dico_image.size %}
                            {{ dico_image.size[0] }} x {{ dico_image.size[1] }} px
                        {% else %}
                            N.R
                        {% endif %}
                        </p>

                    <p class="card-text my-1"><b class="text-black"><i class="bi bi-pin-map-fill"></i> </b> <b> localisation GPS :</b></p>
                    <ul class="my-0 pt-0 ms-2">
                        <li style="font-size:0.8em;"><b>lat. : </b>{{ dico_image.location[0]|default('N.R')}}</li>
                        <li style="font-size:0.8em;"><b>lon. : </b>{{ dico_image.location[1]|default('N.R')}}</li>
                    </ul>
                    
                    {% if dico_image.location %}
                        <p class="card-text my-1"><b class="text-black"><i class="bi bi-crosshair"></i> :</b>
                        <a href="https://www.google.com/maps/search/?api=1&query={{ dico_image.location[0] }}%2C{{ dico_image.location[1] }}&hl=fr" target="_blank" title="Ouvrir Google Maps sur la coordonnée">Voir sur Google Maps</a></p>
                    {% endif %}
                </div>

                <div class="card-footer bg-body-tertiary small m-0 p-2 text-center">
                    <ul class="list-inline m-0 p-0">
                        <!-- Button trigger modal : -->
                        <li class="list-inline-item">                                                       
                            <button type="button"
                                    class="btn btn-warning m-0 py-1 px-2"
                                    data-bs-toggle="modal"
                                    data-bs-target="#{{ dico_image.name }}"
                                    title="Ouvrir la photo">
                                <i class="bi bi-image-fill p-0 m-0"></i>
                            </button>
                        </li>

                        <!-- Button download :  -->
                         <li class="list-inline-item">
                            <button type="button"
                                    class="btn btn-warning m-0 py-1 px-2"
                                    id='btn-{{ dico_image.name }}'
                                    title="Télécharger l'image">
                                <i class="bi bi-download p-0 m-0"></i>
                            </button>
                        </li>
                    </ul>
                </div>
            </div> 


            <!-- MODALE VISU PHOTO :  -->            

            <div class="modal fade" id="{{ dico_image.name }}" tabindex="-1" aria-labelledby="dico_image.name" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-xl">
                <div class="modal-content">

                    <!-- Entête : -->
                    <div class="modal-header bg-black text-warning">
                        <h5 class="modal-title" id="exampleModalLabel">{{ dico_image.name }}</h5>
                        <button type="button" class="btn-close bg-danger" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Photo : -->
                    <div class="modal-body text-center" style="background-color:rgb(55, 55, 55)">
                        <img src="{{ SITEURL }}/galerie/{{ galerie_name }}/{{ dico_image.name }}" style="max-width:100%; max-height: 70vh;"
                             id="img-{{ dico_image.name }}">
                    </div>

                    <!-- Pied : -->
                    <div class="modal-body d-flex m-0 p-0 pt-2 px-3 bg-black justify-content-start text-white small">

                        <div class="">
                            <ul class="list-unstyled">
                                <li><b class="me-2 text-warning"><i class="bi bi-calendar-day"></i> : </b>{% if dico_image.date %}{{ format_date(dico_image.date, '%d/%m/%Y') }}{% else %}N.R{% endif %}</li>
                                <li><b class="me-2 text-warning"> <i class="bi bi-clock"></i> : </b>{% if dico_image.date %}{{ format_date(dico_image.date, '%H:%M') }}{% else %}N.R{% endif %}</li>
                                <li><b class="me-2 text-warning"><i class="bi bi-aspect-ratio"></i> : </b>
                                    {% if dico_image.size %}
                                        {{ dico_image.size[0] }} x {{ dico_image.size[1] }} px
                                    {% else %}
                                        N.R
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
    
                        <div class="ms-4" >      
                            <p class="m-0 p-0"><b class="text-warning"><i class="bi bi-pin-map-fill"></i> </b> <b> localisation GPS :</b></p>
                            <ul class="ms-2">
                                <li style="font-size:0.8em;"><b>lat. : </b>{{ dico_image.location[0]|default('N.R')}}</li>
                                <li style="font-size:0.8em;"><b>lon. : </b>{{ dico_image.location[1]|default('N.R')}}</li>
                            </ul>
                        </div> 
                        
                        <!-- <div class="col">
                            <p class="my-1"><b class="text-black"><i class="bi bi-crosshair"></i> :</b>
                            <a href="https://www.google.com/maps/search/?api=1&query={{ dico_image.location[0] }}%2C{{ dico_image.location[1] }}&hl=fr" target="_blank" title="Ouvrir Google Maps sur la coordonnée">Voir sur Google Maps</a></p>
                        </div> -->
                    
                        <div class="align-self-center ms-auto">
                            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->                         
                            <button type="button"
                                    class="btn btn-warning"
                                    id='btn-modal-{{ dico_image.name }}'
                                    title="Télécharger l'image">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>

                    </div>
                </div>
                </div>
            </div>


             <!-- Script JS pour le téléchargement des images : -->
            <script>
                // Téléchargement de l'image :
                function downloadImage(imageSrc, fileName) {
                    var link = document.createElement('a');
                    link.href = imageSrc;
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                // Bouton de téléchargement depuis le modal :
                document.getElementById('btn-modal-{{ dico_image.name }}').addEventListener('click', function() {
                    var image = document.getElementById('img-{{ dico_image.name }}').src;
                    downloadImage(image, '{{ dico_image.name }}');
                });

                // Bouton de téléchargement direct depuis la page des vignettes :
                document.getElementById('btn-{{ dico_image.name }}').addEventListener('click', function() {
                    var image = '{{ SITEURL }}/galerie/{{ galerie_name }}/{{ dico_image.name }}';
                    downloadImage(image, '{{ dico_image.name }}');
                });
            </script>
            
        {% endfor %}
    </div>            

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Sélectionner les éléments nécessaires
            const switchInfosPhotos = document.getElementById('switch-infos-photos');
            const selectSize = document.getElementById('select-size');
    
            // Fonction pour afficher/masquer les éléments avec la classe "info-exif"
            function toggleExifInfo() {
                const exifElements = document.querySelectorAll('.info-exif');
                exifElements.forEach(function(element) {
                    element.style.display = switchInfosPhotos.checked ? 'block' : 'none';
                });
            }
    
            // Fonction pour appliquer la taille sélectionnée aux éléments avec la classe "size-thumbnail"
            function applyThumbnailSize() {
                const selectedSize = selectSize.value;
                const thumbnailElements = document.querySelectorAll('.size-thumbnail');
                
                thumbnailElements.forEach(function(element) {
                    element.style.width = `${selectedSize}px`;
                });
    
                // Si la taille sélectionnée est 128px, désactiver et neutraliser le switch
                if (selectedSize === '128') {
                    switchInfosPhotos.checked = false; // Désactiver le switch
                    switchInfosPhotos.disabled = true; // Désactiver le contrôle du switch
                    toggleExifInfo(); // Masquer les infos EXIF
                } else {
                    switchInfosPhotos.disabled = false; // Réactiver le switch si la taille est différente de 128px
                }
            }
    
            // Ajouter les écouteurs d'événements
            switchInfosPhotos.addEventListener('change', toggleExifInfo);
            selectSize.addEventListener('change', applyThumbnailSize);
    
            // Appliquer l'état initial
            toggleExifInfo();
            applyThumbnailSize();
        });
    </script>
    
    

{% endblock %}


<!-- NAVBAR DE PIED : -->
{% block bottom_nav_bar %}

    <nav class="container text-center p-0">
        <div class="row">
            <a class="col-6 btn btn-dark text-warning fs-3"
            title="Retour à l'accueil"
            href="{{ SITEURL }}">
                <i class="bi bi-house-up"></i>
            </a>
            <a class="col-6 btn btn-dark text-warning fs-3"
            title="Retour haut de page"
            href="#">
                <i class="bi bi-chevron-bar-up"></i>
            </a>
        </div>

    </nav>

{% endblock %}